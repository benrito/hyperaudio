/*! hyperaudio v0.0.17 ~ (c) 2012-2013 Hyperaudio Inc. <hello@hyperaud.io> (http://hyperaud.io) ~ Built: 23rd October 2013 18:22:46 */
var HA=function(a,b){var c=function(){function a(){}function c(b){var c=b.length,d=a.type(b);return a.isWindow(b)?!1:1===b.nodeType&&c?!0:"array"===d||"function"!==d&&(0===c||"number"==typeof c&&c>0&&c-1 in b)}var d={},e=d.toString,f=d.hasOwnProperty;return a.extend=function(){var b,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[1]||{},i=2),"object"==typeof h||a.isFunction(h)||(h={}),j===i&&(h=this,--i);j>i;i++)if(null!=(b=arguments[i]))for(c in b)d=h[c],e=b[c],h!==e&&(k&&e&&(a.isPlainObject(e)||(f=a.isArray(e)))?(f?(f=!1,g=d&&a.isArray(d)?d:[]):g=d&&a.isPlainObject(d)?d:{},h[c]=a.extend(k,g,e)):void 0!==e&&(h[c]=e));return h},a.extend({isFunction:function(b){return"function"===a.type(b)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},type:function(a){return null==a?String(a):"object"==typeof a||"function"==typeof a?d[e.call(a)]||"object":typeof a},isPlainObject:function(b){if("object"!==a.type(b)||b.nodeType||a.isWindow(b))return!1;try{if(b.constructor&&!f.call(b.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}return!0}}),a.extend({each:function(a,b){var d,e=0,f=a.length,g=c(a);if(g)for(;f>e&&(d=b.call(a[e],e,a[e]),d!==!1);e++);else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a}}),a.extend({event:{ready:"ha:ready",load:"ha:load",save:"ha:save",error:"ha:error"},_commonMethods:{options:{DEBUG:!0,entity:"core"},_trigger:function(b,c){var d=a.extend(!0,{options:this.options},c),e=new CustomEvent(b,{detail:d,bubbles:!0,cancelable:!0});this.target.dispatchEvent(e)},_error:function(b){var c={msg:this.options.entity+" Error : "+b};this._trigger(a.event.error,c)},_debug:function(){var b=this;a.each(a.event,function(a,c){b.target.addEventListener(c,function(a){console.log(b.options.entity+" "+c+" event : %o",a)},!1)})}},register:function(b,c){"string"==typeof b&&("function"==typeof c?(c.prototype=a.extend({},this._commonMethods,c.prototype),this[b]=function(a){return new c(a)}):"object"==typeof c&&(c=a.extend({},this._commonMethods,c),this[b]=c))},utility:function(a,b){"string"==typeof a&&(this[a]=b)},jsonp:function(a,c,d){b.getElementsByTagName("head")[0];var e=b.createElement("script");e.type="text/javascript";var f=0;d[f++]=function(){d.call(c,data)},e.src=a},hasClass:function(a,b){if(!a)return!1;var c=new RegExp("(^|\\s)"+b+"(\\s|$)");return c.test(a.className)},addClass:function(a,b){if(!this.hasClass(a,b)){var c=a.className.split(" ");c.push(b),a.className=c.join(" ")}},removeClass:function(a,b){if(this.hasClass(a,b)){var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");a.className=a.className.replace(c," ")}}}),a}(),d=function(a,b,c){function d(a){this.options={handle:null,dropArea:null,init:!0,touch:!0,mouse:!0,timeout:500,html:"",draggableClass:"",containerTag:"article",blockTag:"section"};for(var c in a)this.options[c]=a[c];this.dropArea="string"==typeof this.options.dropArea?b.querySelector(this.options.dropArea):this.options.dropArea,this.list=this.dropArea.querySelector(this.options.containerTag),this.list||(this.list=b.createElement(this.options.containerTag),this.dropArea.appendChild(this.list)),this.placeholder=b.createElement(this.options.blockTag),this.placeholder.className="placeholder",this.options.init&&(this.handle="string"==typeof this.options.handle?b.querySelector(this.options.handle):this.options.handle,this.handleClassName=this.handle.className,this.reordering=this.handle.parentNode==this.list,this.options.touch&&this.handle.addEventListener("touchstart",this,!1),this.options.mouse&&this.handle.addEventListener("mousedown",this,!1))}return d.prototype.handleEvent=function(a){switch(a.type){case"mousedown":if(1!==a.which)break;case"touchstart":this.start(a);break;case"touchmove":case"mousemove":this.move(a);break;case"touchend":case"mouseup":this.end(a)}},d.prototype.start=function(a){var c=a.touches?a.touches[0]:a,d=a.touches?b.elementFromPoint(c.pageX,c.pageY):c.target;/INPUT/.test(d.tagName)||(a.preventDefault(),this.options.touch&&b.addEventListener("touchend",this,!1),this.options.mouse&&b.addEventListener("mouseup",this,!1),clearTimeout(this.dragTimeout),this.initiated=!1,this.lastTarget=null,this.dragTimeout=setTimeout(this.init.bind(this,this.options.html||this.handle.innerHTML,a),this.options.timeout))},d.prototype.init=function(a,c){this.options.init||(this.options.touch&&b.addEventListener("touchend",this,!1),this.options.mouse&&b.addEventListener("mouseup",this,!1)),this.draggable=b.createElement("div"),this.draggable.className="draggable "+this.options.draggableClass,this.draggableStyle=this.draggable.style,this.draggableStyle.cssText="position:absolute;z-index:1000;pointer-events:none;left:-99999px",this.draggable.innerHTML=a,b.body.appendChild(this.draggable),this.draggableCenterX=Math.round(this.draggable.offsetWidth/2),this.draggableCenterY=Math.round(this.draggable.offsetHeight/2),this.position(c),this.options.touch&&b.addEventListener("touchmove",this,!1),this.options.mouse&&b.addEventListener("mousemove",this,!1),this.initiated=!0,this.reordering&&(this.handle.style.display="none"),this.move(c),this.options.onDragStart&&this.options.onDragStart.call(this)},d.prototype.position=function(a){var b=a.changedTouches?a.changedTouches[0]:a;this.draggableStyle.left=b.pageX-this.draggableCenterX+"px",this.draggableStyle.top=b.pageY-this.draggableCenterY+"px"},d.prototype.move=function(a){a.preventDefault(),a.stopPropagation();var d=a.changedTouches?a.changedTouches[0]:a,e=a.touches?b.elementFromPoint(d.pageX,d.pageY):d.target;if(this.position(a),e!=this.lastTarget&&e!=this.placeholder&&e!=this.list){if(this.lastTarget=e,e==this.dropArea)return this.list.appendChild(this.placeholder),void 0;if(c.hasClass(e,"item")){for(var f=this.list.querySelectorAll(".item"),g=0,h=f.length;h>g;g++)if(e==f[g]){this.list.insertBefore(this.placeholder,f[g]);break}}else this.list.querySelector(".placeholder")&&this.placeholder.parentNode.removeChild(this.placeholder)}},d.prototype.end=function(a){if(clearTimeout(this.dragTimeout),b.removeEventListener("touchend",this,!1),b.removeEventListener("mouseup",this,!1),this.initiated){b.removeEventListener("touchmove",this,!1),b.removeEventListener("mousemove",this,!1);var c=a.changedTouches?a.changedTouches[0]:a;a.touches?b.elementFromPoint(c.pageX,c.pageY):c.target;var d=this.options.html?this.handle.innerHTML:this.draggable.innerHTML;if(this.draggable.parentNode.removeChild(this.draggable),this.draggable=null,!this.list.querySelector(".placeholder"))return this.reordering&&this.handle.parentNode.removeChild(this.handle),this.options.onDrop&&this.options.onDrop.call(this,null),void 0;var e;this.reordering?(e=this.handle,this.handle.style.display=""):(e=b.createElement(this.options.blockTag),e.className=this.handleClassName||"item",e.innerHTML=d),this.list.insertBefore(e,this.placeholder),this.placeholder.parentNode.removeChild(this.placeholder),this.options.onDrop&&this.options.onDrop.call(this,e)}},d.prototype.destroy=function(){b.removeEventListener("touchstart",this,!1),b.removeEventListener("touchmove",this,!1),b.removeEventListener("touchend",this,!1),b.removeEventListener("mousedown",this,!1),b.removeEventListener("mousemove",this,!1),b.removeEventListener("mouseup",this,!1)},d}(a,b,c),e=function(a,b,c){function d(a){var b=(a.innerText||a.textContent).split(" ");a.innerHTML="<a>"+b.join(" </a><a>")+"</a>"}function e(a){this.options={el:null,addHelpers:!1,touch:!0,mouse:!0,threshold:10};for(var c in a)this.options[c]=a[c];this.element="string"==typeof this.options.el?b.querySelector(this.options.el):this.options.el,this.options.addHelpers&&d(this.element),this.words=this.element.querySelectorAll("a"),this.wordsCount=this.words.length,this.options.touch&&this.element.addEventListener("touchstart",this,!1),this.options.mouse&&this.element.addEventListener("mousedown",this,!1)}return e.prototype.handleEvent=function(a){switch(a.type){case"mousedown":if(1!==a.which)break;case"touchstart":this.start(a);break;case"touchmove":case"mousemove":this.move(a);break;case"touchend":case"mouseup":this.end(a)}},e.prototype.start=function(b){b.preventDefault(),b.touches?b.touches[0]:b,this.selectStarted=!1,this.startX=b.pageX,this.startY=b.pageY,this.options.mouse&&(this.element.addEventListener("mousemove",this,!1),a.addEventListener("mouseup",this,!1)),this.options.touch&&(this.element.addEventListener("touchmove",this,!1),a.addEventListener("touchend",this,!1)),c.hasClass(b.target,"selected")&&(this.dragTimeout=setTimeout(this.dragStart.bind(this,b),500))},e.prototype.selectStart=function(a){var b,d=a.target;if(d!=this.element&&"A"==d.tagName){if(this.selectStarted=!0,this.currentWord=d,c.removeClass(this.element.querySelector(".first"),"first"),c.removeClass(this.element.querySelector(".last"),"last"),this.words[this.startPosition]===d)return b=this.startPosition,this.startPosition=this.endPosition,this.endPosition=b,void 0;if(this.words[this.endPosition]!==d){for(var e=0;e<this.wordsCount;e++)this.words[e]==d&&(this.startPosition=e),c.removeClass(this.words[e],"selected");this.endPosition=this.startPosition,c.addClass(d,"selected")}}},e.prototype.move=function(a){var d,e=a.changedTouches?a.changedTouches[0]:a,f=a.touches?b.elementFromPoint(e.pageX,e.pageY):e.target;if(!(Math.abs(e.pageX-this.startX)<this.options.threshold&&Math.abs(e.pageY-this.startY)<this.options.threshold)){if(clearTimeout(this.dragTimeout),!this.selectStarted)return this.selectStart(a),void 0;if("P"==f.tagName&&(f=f.querySelector("a:last-child")),f!=this.element&&f!=this.currentWord&&"A"==f.tagName){for(var g=0;g<this.wordsCount;g++)this.words[g]==f&&(d=g),void 0===d&&g>=this.startPosition||void 0!==d&&g<=this.startPosition||d==g?c.addClass(this.words[g],"selected"):c.removeClass(this.words[g],"selected");this.currentWord=f,this.endPosition=d}}},e.prototype.end=function(a){if(clearTimeout(this.dragTimeout),this.options.touch&&(this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1)),this.options.mouse&&(this.element.removeEventListener("mousemove",this,!1),this.element.removeEventListener("mouseup",this,!1)),!this.selectStarted)return a.target==this.element&&this.clearSelection(),void 0;var b=Math.min(this.startPosition,this.endPosition),d=Math.max(this.startPosition,this.endPosition);c.addClass(this.words[b],"first"),c.addClass(this.words[d],"last")},e.prototype.clearSelection=function(){this.currentWord=null,this.startPosition=null,this.endPosition=null,c.removeClass(this.element.querySelector(".first"),"first"),c.removeClass(this.element.querySelector(".last"),"last"),this.options.touch&&(this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1)),this.options.mouse&&(this.element.removeEventListener("mousemove",this,!1),this.element.removeEventListener("mouseup",this,!1));for(var a=this.element.querySelectorAll(".selected"),b=0,d=a.length;d>b;b++)c.removeClass(a[b],"selected")},e.prototype.getSelection=function(){for(var a,b=this.element.querySelectorAll(".selected"),c="",d=0,e=b.length;e>d;d++)b[d].parentNode!==a&&(a=b[d].parentNode,c+=0===d?"<p>":"</p><p>"),c+=b[d].outerHTML.replace(/ class="[\d\w\s\-]*\s?"/gi," ");return c&&(c+="</p>"),c},e.prototype.dragStart=function(a){a.stopPropagation(),this.options.touch&&(this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1)),this.options.mouse&&(this.element.removeEventListener("mousemove",this,!1),this.element.removeEventListener("mouseup",this,!1)),a.changedTouches?a.changedTouches[0]:a,this.options.onDragStart&&this.options.onDragStart.call(this,a)},e.prototype.destroy=function(){this.element.removeEventListener("touchstart",this,!1),this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1),this.element.removeEventListener("mousedown",this,!1),this.element.removeEventListener("mousemove",this,!1),this.element.removeEventListener("mouseup",this,!1)},e}(a,b,c),f=function(a){return function(b){b=a.extend({url:"",data:"",type:"GET",responseType:"",async:!0,timeout:0,cache:!0},b),b.cache||(b.url=b.url+(/\?/.test(b.url)?"&":"?")+(new Date).getTime());var c=new XMLHttpRequest;return c.addEventListener("load",function(a){200===this.status?"function"==typeof b.complete&&b.complete.call(this,a):"function"==typeof b.error&&b.error.call(this,a)},!1),"function"==typeof b.error&&(c.addEventListener("error",function(a){b.error.call(this,a)},!1),c.addEventListener("abort",function(a){b.error.call(this,a)},!1)),c.open(b.type,b.url,b.async),c.responseType=b.responseType,c.timeout=b.timeout,b.data&&c.setRequestHeader("content-type","application/json; charset=utf-8"),c.send(b.data),c}}(c),g=function(a){return{init:function(b){this.options=a.extend({api:"https://data.hyperaud.io/",transcripts:"transcripts/",mixes:"mixes/",whoami:"whoami/"},b),this.error=!1,this.guest=!1,this.username="",this.transcripts=null,this.transcript=null,this.mixes=null,this.mix=null},callback:function(a,b){"function"==typeof a&&a.call(this,b)},getUsername:function(a,b){var c=this;b||!this.guest&&!this.username?f({url:this.options.api+this.options.whoami,complete:function(){var b=JSON.parse(this.responseText);c.guest=!b.user,c.username=c.guest?"":b.user.username,c.callback(a,!0)},error:function(){this.error=!0,c.callback(a,!1)}}):setTimeout(function(){c.callback(a,!0)},0)},getTranscripts:function(a,b){var c=this;!b&&this.transcripts?setTimeout(function(){c.callback(a,!0)},0):f({url:this.options.api+this.options.transcripts,complete:function(){var b=JSON.parse(this.responseText);c.transcripts=b,c.callback(a,!0)},error:function(){this.error=!0,c.callback(a,!1)}})},getTranscript:function(a,b,c){var d=this;!c&&this.transcript&&this.transcript._id===a?setTimeout(function(){d.callback(b,!0)},0):this.getUsername(function(c){c&&a?f({url:this.options.api+(this.guest?"":this.username+"/")+this.options.transcripts+a,complete:function(){var a=JSON.parse(this.responseText);d.transcript=a,d.callback(b,!0)},error:function(){this.error=!0,d.callback(b,!1)}}):(this.error=!0,d.callback(b,!1))})},getMixes:function(a,b){var c=this;!b&&this.mixes?setTimeout(function(){c.callback(a,!0)},0):this.getUsername(function(b){b?f({url:this.options.api+(this.guest?"":this.username+"/")+this.options.mixes,complete:function(){var b=JSON.parse(this.responseText);c.mixes=b,c.callback(a,!0)},error:function(){this.error=!0,c.callback(a,!1)}}):(this.error=!0,c.callback(a,!1))})},getMix:function(a,b,c){var d=this;!c&&this.mix&&this.mix._id===a?setTimeout(function(){d.callback(b,!0)},0):this.getUsername(function(c){c&&a?f({url:this.options.api+(this.guest?"":this.username+"/")+this.options.mixes+a,complete:function(){var a=JSON.parse(this.responseText);d.mix=a,d.callback(b,!0)},error:function(){this.error=!0,d.callback(b,!1)}}):(this.error=!0,d.callback(b,!1))})},putMix:function(a,b){var c=this;if("object"==typeof a){var d="POST",e="";this.mix&&this.mix._id&&this.mix._id===a._id&&(d="PUT",e=this.mix._id),f({url:this.options.api+this.username+"/"+this.options.mixes+e,type:d,data:JSON.stringify(a),complete:function(){var a=JSON.parse(this.responseText);c.mix=a,c.callback(b,!0)},error:function(){this.error=!0,c.callback(b,!1)}})}else setTimeout(function(){c.callback(b,!1)},0)}}}(c),h=function(a,b,c,d){function e(d){this.options=c.extend({},this.options,{entity:"PLAYER",target:"#transcript-video",src:"",guiNative:!1,gui:!1,cssClassPrefix:"hyperaudio-player-",async:!0},d),this.target="string"==typeof this.options.target?b.querySelector(this.options.target):this.options.target,this.videoElem=null,this.timeout={},this.commandsIgnored=/ipad|iphone|ipod|android/i.test(a.navigator.userAgent),this.gui=null,this.options.DEBUG&&this._debug(),this.target&&this.create()}return e.prototype={create:function(){this.target?(this.videoElem=b.createElement("video"),this.videoElem.controls=this.options.guiNative,this.videoElem.addEventListener("progress",function(){this.readyState>0&&(this.commandsIgnored=!1)},!1),this.target.innerHTML="",this.target.appendChild(this.videoElem),this.options.gui&&(this.addGUI(),this.addGUIListeners()),this.options.src&&this.load()):this._error("Target not found : "+this.options.target)},addGUI:function(){var a=this;this.target?(this.gui={container:this.target,gui:b.createElement("div"),controls:b.createElement("div"),play:b.createElement("a"),pause:b.createElement("a")},c.each(this.gui,function(b){c.addClass(this,a.options.cssClassPrefix+b)}),this.gui.play.addEventListener("click",function(b){b.preventDefault(),a.play()},!1),this.gui.pause.addEventListener("click",function(b){b.preventDefault(),a.pause()},!1),this.gui.pause.style.display="none",this.gui.gui.appendChild(this.gui.controls),this.gui.controls.appendChild(this.gui.play),this.gui.controls.appendChild(this.gui.pause),this.target.appendChild(this.gui.gui)):this._error("Target not found : "+this.options.target)},addGUIListeners:function(){var a=this;this.gui?this.videoElem.addEventListener("ended",function(){a.gui.play.style.display="",a.gui.pause.style.display="none"},!1):this._error("GUI not used: gui = "+this.options.gui)},load:function(a){a&&(this.options.src=a),this.videoElem?(this.killPopcorn(),this.videoElem.src=this.options.src,this.initPopcorn()):this._error("Video player not created : "+this.options.target)},initPopcorn:function(){this.killPopcorn(),this.popcorn=d(this.videoElem)},killPopcorn:function(){this.popcorn&&(this.popcorn.destroy(),delete this.popcorn)},play:function(a){this.gui&&(this.gui.play.style.display="none",this.gui.pause.style.display=""),this.currentTime(a,!0)},pause:function(a){this.gui&&(this.gui.play.style.display="",this.gui.pause.style.display="none"),this.videoElem.pause(),this.currentTime(a)},currentTime:function(a,b){var c=this,d=this.videoElem;if(clearTimeout(this.timeout.currentTime),"number"!=typeof a||isNaN(a))b&&d.play();else{b&&this.commandsIgnored&&d.play();try{if(d.seekable&&!("object"==typeof d.seekable&&d.seekable.length>0))throw 1;d.currentTime=a,b&&d.play()}catch(e){this.timeout.currentTime=setTimeout(function(){c.currentTime(a,b)},250)}}}},e}(a,b,c,Popcorn),i=function(a,b){function c(c){this.options=b.extend({},this.options,{entity:"TRANSCRIPT",target:"#transcript",src:"",video:"",group:"p",word:"a",timeAttr:"data-m",unit:.001,async:!0,stage:null,player:null},c),this.ready=!1,this.enabled=!0,this.target="string"==typeof this.options.target?a.querySelector(this.options.target):this.options.target,this.textSelect=null,this.options.DEBUG&&this._debug(),this.options.src&&this.load()}return c.prototype={load:function(a){var c=this;this.ready=!1,a&&(a.src&&(this.options.src=a.src),a.video&&(this.options.video=a.video));var d=function(){c.options.async?setTimeout(function(){c.setVideo()},0):c.setVideo()};this.target&&(this.target.innerHTML="",f({url:this.options.src,complete:function(){c.target.innerHTML=this.responseText,c._trigger(b.event.load,{msg:'Loaded "'+c.options.src+'"'}),d()},error:function(){c.target.innerHTML="Problem with transcript URL.",c._error(this.status+" "+this.statusText+' : "'+c.options.src+'"'),d()}}))},setVideo:function(a){var b=this;a&&(this.options.video=a),this.options.player?(this.options.player.load(this.options.video),this.options.async?setTimeout(function(){b.parse()},0):this.parse()):(this._error("Player not defined"),this.selectorize())},parse:function(){var a=this.options;if(this.target&&a.player&&a.player.popcorn){var b,c=this.target.querySelectorAll(a.target+" "+a.word),d=c.length,e=function(){};for(b=0;d>b;b++)a.player.popcorn.transcript({time:c[b].getAttribute(a.timeAttr)*a.unit,futureClass:"transcript-grey",target:c[b],onNewPara:e});this.target.addEventListener("click",function(b){if(b.preventDefault(),b.target.nodeName.toLowerCase()===a.word){var c=b.target.getAttribute(a.timeAttr),d=c*a.unit;a.player.currentTime(d)}},!1)}this.selectorize()},selectorize:function(){var a=this,c=this.options;c.stage&&(this.deselectorize(),this.textSelect=new e({el:c.target,onDragStart:function(e){b.addClass(c.stage.target,c.stage.options.dragdropClass);var f=new d({dropArea:c.stage.target,init:!1,onDrop:function(b){a.textSelect.clearSelection(),this.destroy(),b.setAttribute(c.stage.options.idAttr,c.video),b.setAttribute(c.stage.options.unitAttr,c.unit),c.stage._dropped(b)}}),g=this.getSelection().replace(/ class="[\d\w\s\-]*\s?"/gi,"");f.init(g,e)}}),this.ready=!0,this._trigger(b.event.ready))},deselectorize:function(){this.textSelect&&this.textSelect.destroy(),delete this.textSelect},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1}},c}(b,c),j=function(a,b){function c(c){this.options=b.extend({},this.options,{entity:"STAGE",target:"#stage",src:"",api:"api/",idAttr:"data-id",unitAttr:"data-unit",dragdropClass:"dragdrop",async:!0,projector:null},c),this.ready=!1,this.enabled=!0,this.target="string"==typeof this.options.target?a.querySelector(this.options.target):this.options.target,this.options.DEBUG&&this._debug(),this.options.projector&&this.options.projector.setStage(this),this.options.src&&this.load()}return c.prototype={load:function(a){a&&(this.options.src=a)},save:function(){var a=this,c="mp",d="Not Yet Defined",e=this.options.api+c+"/mixes/";this.target&&this.target.getElementsByTagName("section").length&&f({url:e,type:"POST",data:"json="+JSON.stringify({label:d,content:this.target.innerHTML}),complete:function(){a._trigger(b.event.save,{msg:"Saved mix"})},error:function(){a._error(this.status+" "+this.statusText+' : "'+e+'"')}})},parse:function(){this.options},_dropped:function(a){var c=this;this.target&&(b.removeClass(this.target,this.options.dragdropClass),a._dragInstance=new d({handle:a,dropArea:this.target,html:a.innerHTML,onDragStart:function(){b.addClass(c.target,c.options.dragdropClass)},onDrop:function(){b.removeClass(c.target,c.options.dragdropClass)}}))},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1}},c}(b,c),k=function(a,b,c){function d(a){this.options=c.extend({},this.options,{entity:"PROJECTOR",target:"#transcript-video",src:"",tPadding:1,players:1,unit:.001,gui:!0,cssClassPrefix:"hyperaudio-player-",async:!0},a),this.target="string"==typeof this.options.target?b.querySelector(this.options.target):this.options.target,this.stage=null,this.player=[],this.current={},this.gui=null,this.paused=!0,this.options.DEBUG&&this._debug(),this.target&&this.create()}return d.prototype={setStage:function(a){this.stage=a},create:function(){var a=this;if(this.target){for(var d=function(b){a.manager(b)},e=0;e<this.options.players;e++){var f=b.createElement("div");this.player[e]=c.Player({target:f}),this.player[e].videoElem.addEventListener("timeupdate",d,!1),this.target.appendChild(f)}this.options.gui&&this.addGUI(),this.options.src&&this.load()}else this._error("Target not found : "+this.options.target)},addGUI:h.prototype.addGUI,load:function(a){a&&(this.options.src=a),this.player[0]?this.player[0].load(this.options.src):this._error("Video player not created : "+this.options.target)},play:function(){this.stage&&this.stage.target?(this.stageArticle=this.stage.target.getElementsByTagName("article")[0],this.current.sections=this.stageArticle.getElementsByTagName("section"),this.setCurrent(0),this.paused=!1,this.load(this.current.src),this._play(this.current.start)):this.paused=!0},pause:function(){this.paused=!0,this._pause()},_play:function(a){this.gui&&(this.gui.play.style.display="none",this.gui.pause.style.display=""),this.player[0].play(a)},_pause:function(a){this.gui&&(this.gui.play.style.display="",this.gui.pause.style.display="none"),this.player[0].pause(a)},currentTime:function(a,b){this.player[0].currentTime(a,b)},setCurrent:function(a){this.current.index=a,this.current.section=this.current.sections[this.current.index],this.current.src=this.current.section.getAttribute(this.stage.options.idAttr);var b=1*this.current.section.getAttribute(this.stage.options.unitAttr);this.current.unit=b=b>0?b:this.options.unit;var c=this.current.section.getElementsByTagName("a");this.current.start=c[0].getAttribute("data-m")*b,this.current.end=c[c.length-1].getAttribute("data-m")*b},manager:function(){this.paused||this.player[0].videoElem.currentTime>this.current.end+this.options.tPadding&&(++this.current.index<this.current.sections.length?(this.setCurrent(this.current.index),this.load(this.current.src),this._play(this.current.start)):(this.current.index=0,this.paused=!0,this._pause()))}},d}(a,b,c,Popcorn);return c.register("Player",h),c.register("Transcript",i),c.register("Stage",j),c.register("Projector",k),c.utility("DragDrop",d),c.utility("WordSelect",e),c.utility("xhr",f),c.utility("api",g),c}(window,document);