/*! hyperaudio v0.0.1 ~ (c) 2012-2013 Hyperaudio Inc. <hello@hyperaud.io> (http://hyperaud.io) */
var ha=function(t,e){var s=function(t,e){function s(t,s,i){this.options={init:!0,touch:!0,mouse:!0,timeout:500,html:""};for(var o in i)this.options[o]=i[o];this.droppable="string"==typeof s?e.querySelector(s):s,this.list=this.droppable.querySelector("ul"),this.list||(this.list=e.createElement("ul"),this.droppable.appendChild(this.list)),this.placeholder=e.createElement("li"),this.placeholder.className="placeholder",this.options.init&&(this.handle="string"==typeof t?e.querySelector(t):t,this.reordering=this.handle.parentNode==this.list,this.options.touch&&this.handle.addEventListener("touchstart",this,!1),this.options.mouse&&this.handle.addEventListener("mousedown",this,!1))}return s.prototype.handleEvent=function(t){switch(t.type){case"mousedown":if(1!==t.which)break;case"touchstart":this.start(t);break;case"touchmove":case"mousemove":this.move(t);break;case"touchend":case"mouseup":this.end(t)}},s.prototype.start=function(t){t.preventDefault(),clearTimeout(this.dragTimeout),this.initiated=!1,this.lastTarget=null,this.dragTimeout=setTimeout(this.init.bind(this,this.options.html,t),this.options.timeout)},s.prototype.init=function(t,s){this.options.touch&&e.addEventListener("touchend",this,!1),this.options.mouse&&e.addEventListener("mouseup",this,!1),this.draggable=e.createElement("div"),this.draggable.className="draggable",this.draggableStyle=this.draggable.style,this.draggableStyle.cssText="position:absolute;z-index:1000;pointer-events:none;left:-99999px",this.draggable.innerHTML=t,e.body.appendChild(this.draggable),this.draggableCenterX=Math.round(this.draggable.offsetWidth/2),this.draggableCenterY=Math.round(this.draggable.offsetHeight/2),this.position(s),this.options.touch&&e.addEventListener("touchmove",this,!1),this.options.mouse&&e.addEventListener("mousemove",this,!1),this.initiated=!0,this.reordering&&(this.handle.style.display="none"),this.move(s),this.options.onDragStart&&this.options.onDragStart.call(this)},s.prototype.position=function(t){var e=t.changedTouches?t.changedTouches[0]:t;this.draggableStyle.left=e.pageX-this.draggableCenterX+"px",this.draggableStyle.top=e.pageY-this.draggableCenterY+"px"},s.prototype.move=function(t){t.preventDefault();var s=t.changedTouches?t.changedTouches[0]:t,i=t.touches?e.elementFromPoint(s.pageX,s.pageY):s.target;if(this.position(t),i!=this.lastTarget&&i!=this.placeholder&&i!=this.list){if(this.lastTarget=i,this.list.querySelector(".placeholder")&&this.list.removeChild(this.placeholder),i==this.droppable)return this.list.appendChild(this.placeholder),void 0;if("item"==i.className)for(var o=this.list.querySelectorAll(".item"),n=0,h=o.length;h>n;n++)if(i==o[n]){this.list.insertBefore(this.placeholder,o[n]);break}}},s.prototype.end=function(t){if(clearTimeout(this.dragTimeout),e.removeEventListener("touchend",this,!1),e.removeEventListener("mouseup",this,!1),this.initiated){e.removeEventListener("touchmove",this,!1),e.removeEventListener("mousemove",this,!1);var s=t.changedTouches?t.changedTouches[0]:t;t.touches?e.elementFromPoint(s.pageX,s.pageY):s.target;var i=this.draggable.innerHTML;if(this.draggable.parentNode.removeChild(this.draggable),this.draggable=null,this.reordering&&(this.handle._dragInstance&&(this.handle._dragInstance.destroy(),this.handle._dragInstance=null),this.handle.parentNode.removeChild(this.handle)),this.list.querySelector(".placeholder")){var o=e.createElement("li");o.className="item",o.innerHTML=i,this.list.insertBefore(o,this.placeholder),this.placeholder.parentNode.removeChild(this.placeholder),this.options.onDrop&&this.options.onDrop.call(this,o)}}},s.prototype.destroy=function(){e.removeEventListener("touchstart",this,!1),e.removeEventListener("touchmove",this,!1),e.removeEventListener("touchend",this,!1),e.removeEventListener("mousedown",this,!1),e.removeEventListener("mousemove",this,!1),e.removeEventListener("mouseup",this,!1)},s}(t,e),i=function(t,e){function s(t){var e=(t.innerText||t.textContent).split(" ");t.innerHTML="<a>"+e.join(" </a><a>")+"</a>"}function i(t,e){if(!t)return!1;var s=new RegExp("(^|\\s)"+e+"(\\s|$)");return s.test(t.className)}function o(t,e){if(!i(t,e)){var s=t.className.split(" ");s.push(e),t.className=s.join(" ")}}function n(t,e){if(i(t,e)){var s=new RegExp("(^|\\s)"+e+"(\\s|$)","g");t.className=t.className.replace(s," ")}}function h(t,i){this.element=e.querySelector(t),this.options={addHelpers:!1,touch:!0,mouse:!0,threshold:10};for(var o in i)this.options[o]=i[o];this.options.addHelpers&&s(this.element),this.words=this.element.querySelectorAll("a"),this.wordsCount=this.words.length,this.options.touch&&this.element.addEventListener("touchstart",this,!1),this.options.mouse&&this.element.addEventListener("mousedown",this,!1)}return h.prototype.handleEvent=function(t){switch(t.type){case"mousedown":if(1!==t.which)break;case"touchstart":this.start(t);break;case"touchmove":case"mousemove":this.move(t);break;case"touchend":case"mouseup":this.end(t)}},h.prototype.start=function(t){t.preventDefault(),t.touches?t.touches[0]:t,this.selectStarted=!1,this.startX=t.pageX,this.startY=t.pageY,this.options.mouse&&(this.element.addEventListener("mousemove",this,!1),this.element.addEventListener("mouseup",this,!1)),this.options.touch&&(this.element.addEventListener("touchmove",this,!1),this.element.addEventListener("touchend",this,!1)),i(t.target,"selected")&&(this.dragTimeout=setTimeout(this.dragStart.bind(this,t),500))},h.prototype.selectStart=function(t){var e,s=t.target;if(s!=this.element){if(this.selectStarted=!0,this.currentWord=s,n(this.element.querySelector(".first"),"first"),n(this.element.querySelector(".last"),"last"),this.words[this.startPosition]===s)return e=this.startPosition,this.startPosition=this.endPosition,this.endPosition=e,void 0;if(this.words[this.endPosition]!==s){for(var i=0;i<this.wordsCount;i++)this.words[i]==s&&(this.startPosition=i),n(this.words[i],"selected");this.endPosition=this.startPosition,o(s,"selected")}}},h.prototype.move=function(t){var s,i=t.changedTouches?t.changedTouches[0]:t,h=t.touches?e.elementFromPoint(i.pageX,i.pageY):i.target;if(!(Math.abs(i.pageX-this.startX)<this.options.threshold&&Math.abs(i.pageY-this.startY)<this.options.threshold)){if(clearTimeout(this.dragTimeout),!this.selectStarted)return this.selectStart(t),void 0;if(h!=this.element&&h!=this.currentWord){for(var r=0;r<this.wordsCount;r++)this.words[r]==h&&(s=r),void 0===s&&r>=this.startPosition||void 0!==s&&r<=this.startPosition||s==r?o(this.words[r],"selected"):n(this.words[r],"selected");this.currentWord=h,this.endPosition=s}}},h.prototype.end=function(){if(clearTimeout(this.dragTimeout),this.options.touch&&(this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1)),this.options.mouse&&(this.element.removeEventListener("mousemove",this,!1),this.element.removeEventListener("mouseup",this,!1)),this.selectStarted){var t=Math.min(this.startPosition,this.endPosition),e=Math.max(this.startPosition,this.endPosition);o(this.words[t],"first"),o(this.words[e],"last")}},h.prototype.clearSelection=function(){n(this.element.querySelector(".first"),"first"),n(this.element.querySelector(".last"),"last"),this.options.touch&&(this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1)),this.options.mouse&&(this.element.removeEventListener("mousemove",this,!1),this.element.removeEventListener("mouseup",this,!1));for(var t=this.element.querySelectorAll(".selected"),e=0,s=t.length;s>e;e++)n(t[e],"selected")},h.prototype.getSelection=function(){for(var t=this.element.querySelectorAll(".selected"),e="",s=0,i=t.length;i>s;s++)e+=t[s].innerHTML;return e},h.prototype.dragStart=function(t){t.stopPropagation(),this.options.touch&&(this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1)),this.options.mouse&&(this.element.removeEventListener("mousemove",this,!1),this.element.removeEventListener("mouseup",this,!1)),t.changedTouches?t.changedTouches[0]:t,this.options.onDragStart&&this.options.onDragStart.call(this,t)},h.prototype.destroy=function(){this.element.removeEventListener("touchstart",this,!1),this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1),this.element.removeEventListener("mousedown",this,!1),this.element.removeEventListener("mousemove",this,!1),this.element.removeEventListener("mouseup",this,!1)},h}(t,e),o={};return o.utils={DragDrop:s,WordSelect:i},o}(window,document);